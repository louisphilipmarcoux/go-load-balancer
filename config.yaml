listenAddr: ":8443"
metricsAddr: ":9090"
adminAddr: ":9091"

# NEW: Autocert configuration
autocert:
  enabled: false
  # Email for Let's Encrypt registration
  email: ""
  # Domains to manage (must be real, public domains)
  domains:
    - "lb.your-domain.com"
    - "api.your-domain.com"
  # Folder to cache certificates (so you don't re-request on every restart)
  cacheDir: "./certs"

# NEW: ADD THIS SECTION BACK FOR LOCAL TESTING
tls:
  certFile: "/certs/server.crt"
  keyFile: "/certs/server.key"
  minVersion: "tls1.2"
  cipherSuites:
    - "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256"
    - "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
    - "TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384"
    - "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"

rateLimit:
  enabled: true
  requestsPerSecond: 10
  burst: 20

circuitBreaker:
  enabled: true
  consecutiveFailures: 5
  openStateTimeout: "15s"

# NEW: Add connection pool settings
connectionPool:
  # Max total idle connections (all hosts)
  maxIdleConns: 100
  # Max idle connections *per backend host*
  maxIdleConnsPerHost: 10
  # How long an idle connection is kept open
  idleConnTimeout: "90s"

cache:
  enabled: true
  defaultExpiration: "5m" # How long to cache an item
  cleanupInterval: "10m" # How often to scan for expired items

routes:
  # ---
  # ALL YOUR OTHER ROUTES GO HERE FIRST
  # ---
  - host: "api.example.com"
    path: "/"
    strategy: "round-robin"
    backends:
      - addr: "backend1:9001"
        weight: 1

  - path: "/"
    headers:
      "User-Agent": "MobileApp"
    strategy: "round-robin"
    backends:
      - addr: "backend2:9002"
        weight: 1

  # ---
  # THIS MUST BE THE LAST ROUTE
  # ---
  - path: "/" # This catches everything else
    strategy: "weighted-least-connections"
    backends:
      - addr: "backend3:9003"
        weight: 1
